<div class="flex justify-between items-center mb-4">
    <h1 class="text-3xl font-bold text-gray-800">Listado de Estudiantes</h1>
    
    <a *ngIf="userRol && (userRol === 'Maestro' || userRol === 'Director' || userRol === 'Admin')"
       [routerLink]="['/estudiantes/nuevo']" 
       class="flex items-center bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow transition-all">
      <span class="text-xl mr-2">➕</span>
      Registrar Nuevo
    </a>
    <span *ngIf="!userRol || (userRol !== 'Maestro' && userRol !== 'Director' && userRol !== 'Admin')" 
          class="text-sm text-gray-500 p-2 border rounded-lg bg-gray-200">
          Rol insuficiente para registrar
    </span>
</div>

<app-estudiante-filter (filterChange)="onFilterChange($event)"></app-estudiante-filter>

<div class="overflow-x-auto shadow-md rounded-lg">
    <div *ngIf="estudiantes$ | async as estudiantes; else loading">
        <table *ngIf="estudiantes.length > 0; else noData" class="w-full text-sm text-left text-gray-700">
            <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                <tr>
                    <th scope="col" class="px-6 py-3">ID (Matrícula)</th>
                    <th scope="col" class="px-6 py-3">Nombre Completo</th>
                    <th scope="col" class="px-6 py-3">Carrera (ID)</th>
                    <th scope="col" class="px-6 py-3">Semestre</th>
                    <th scope="col" class="px-6 py-3">Estado</th>
                    <th scope="col" class="px-6 py-3 text-right">Acciones</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <tr *ngFor="let est of estudiantes" class="hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">{{ est.idEstudiante }}</td>
                    <td class="px-6 py-4">{{ est.nombres }} {{ est.apellidoPaterno }} {{ est.apellidoMaterno }}</td>
                    <td class="px-6 py-4">{{ est.carreraID }}</td>
                    <td class="px-6 py-4">{{ est.semestre }}</td>
                    <td class="px-6 py-4">
                        <span *ngIf="est.esBecado" class="px-3 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">Becado</span>
                        <span *ngIf="est.esEgresado" class="px-3 py-1 text-xs font-medium rounded-full bg-indigo-100 text-indigo-800">Egresado</span>
                        <span *ngIf="!est.esBecado && !est.esEgresado" class="px-3 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800">Regular</span>
                    </td>
                    <td class="px-6 py-4 flex justify-end items-center space-x-2">
                        <a [routerLink]="['/estudiantes', est.idEstudiante]" 
                           class="py-1 px-3 rounded-md bg-blue-500 hover:bg-blue-600 text-white font-semibold text-xs transition-all">Ver</a>
                        <a [routerLink]="['/estudiantes', est.idEstudiante, 'editar']" 
                           class="py-1 px-3 rounded-md bg-yellow-400 hover:bg-yellow-500 text-gray-800 font-semibold text-xs transition-all">Editar</a>
                        
                        <button *ngIf="canDelete()" 
                                (click)="askToDelete(est)" 
                                class="py-1 px-3 rounded-md bg-red-500 hover:bg-red-600 text-white font-semibold text-xs transition-all">
                            Eliminar
                        </button>
                        <span *ngIf="!canDelete()" class="text-xs text-gray-400 p-1">No Autorizado</span>
                    </td>
                </tr>
            </tbody>
        </table>

        <ng-template #noData>
            <div class="p-6 text-center text-gray-500">
                No se encontraron estudiantes con los filtros aplicados.
            </div>
        </ng-template>
    </div>

    <ng-template #loading>
        <div class="p-6 text-center text-gray-500">Cargando estudiantes...</div>
    </ng-template>
</div>

<app-confirm-dialog 
    *ngIf="showConfirmDialog"
    [message]="'¿Seguro que desea eliminar a ' + (estudianteAEliminar?.nombres || 'este estudiante') + '?'"
    (confirm)="onConfirmDelete()"
    (cancel)="onCancelDelete()">
</app-confirm-dialog>