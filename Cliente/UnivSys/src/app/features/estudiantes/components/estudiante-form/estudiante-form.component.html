<form [formGroup]="estudianteForm" (ngSubmit)="onSubmit()" class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
  
  <div class="md:col-span-2">
    <label for="idEstudiante" class="form-label">ID Estudiante (Matrícula)</label>
    <input id="idEstudiante" type="text" formControlName="idEstudiante" 
           class="form-input" [ngClass]="inputClass('idEstudiante')">
    <div *ngIf="f['idEstudiante'].touched && f['idEstudiante'].errors?.['required']" class="form-error">
      El ID es requerido.
    </div>
  </div>

  <div class="md:col-span-2">
    <label for="nombres" class="form-label">Nombres</label>
    <input id="nombres" type="text" formControlName="nombres"
           class="form-input" [ngClass]="inputClass('nombres')">
    <div *ngIf="f['nombres'].touched && f['nombres'].errors?.['pattern']" class="form-error">
      No debe contener números ni símbolos.
    </div>
  </div>
  
  <div>
    <label for="apellidoPaterno" class="form-label">Apellido Paterno</label>
    <input id="apellidoPaterno" type="text" formControlName="apellidoPaterno"
           class="form-input" [ngClass]="inputClass('apellidoPaterno')">
    <div *ngIf="f['apellidoPaterno'].touched && f['apellidoPaterno'].invalid" class="form-error">
      Requerido (solo letras).
    </div>
  </div>
  
  <div>
    <label for="apellidoMaterno" class="form-label">Apellido Materno</label>
    <input id="apellidoMaterno" type="text" formControlName="apellidoMaterno"
           class="form-input" [ngClass]="inputClass('apellidoMaterno')">
    <div *ngIf="f['apellidoMaterno'].touched && f['apellidoMaterno'].invalid" class="form-error">
      Requerido (solo letras).
    </div>
  </div>

  <div>
    <label for="carreraID" class="form-label">Carrera</label>
    <select id="carreraID" formControlName="carreraID"
            class="form-select" [ngClass]="inputClass('carreraID')">
      <option [value]="null" disabled>Seleccione una carrera</option>
      <option *ngFor="let carrera of carreras" [value]="carrera.id">
        {{ carrera.nombre }}
      </option>
    </select>
    <div *ngIf="f['carreraID'].touched && f['carreraID'].invalid" class="form-error">
      Carrera requerida.
    </div>
  </div>
  
  <div>
    <label for="semestre" class="form-label">Semestre</label>
    <input id="semestre" type="number" formControlName="semestre"
           class="form-input" [ngClass]="inputClass('semestre')">
    <div *ngIf="f['semestre'].touched && f['semestre'].invalid" class="form-error">
      Debe estar entre 1 y 15.
    </div>
  </div>

  <div class="md:col-span-2 flex items-center space-x-6 pt-4 border-t border-gray-100">
    <label class="flex items-center space-x-2 cursor-pointer">
      <input type="checkbox" formControlName="esBecado" class="form-checkbox">
      <span>¿Es Becado?</span>
    </label>
    <label class="flex items-center space-x-2 cursor-pointer">
      <input type="checkbox" formControlName="esEgresado" class="form-checkbox">
      <span>¿Es Egresado?</span>
    </label>
  </div>
  
  <div *ngIf="estudianteForm.errors?.['flagsExclusivas'] && (f['esBecado'].touched || f['esEgresado'].touched)" 
       class="md:col-span-2 form-error font-bold">
    ERROR: Un estudiante no puede ser Becado y Egresado al mismo tiempo.
  </div>

  <div *ngIf="f['esBecado'].value" class="md:col-span-1 border p-4 rounded-lg bg-blue-50">
    <label for="porcentajeBeca" class="form-label font-bold text-blue-800">Porcentaje Beca *</label>
    <input id="porcentajeBeca" type="number" formControlName="porcentajeBeca" min="1" max="100"
           class="form-input" [ngClass]="inputClass('porcentajeBeca')">
    <div *ngIf="f['porcentajeBeca'].invalid && f['porcentajeBeca'].touched" class="form-error">
      Requerido, debe ser entre 1 y 100.
    </div>
  </div>

  <div *ngIf="f['esEgresado'].value" class="md:col-span-1 border p-4 rounded-lg bg-indigo-50">
    <label for="fechaEgreso" class="form-label font-bold text-indigo-800">Fecha de Egreso *</label>
    <input id="fechaEgreso" type="date" formControlName="fechaEgreso"
           class="form-input" [ngClass]="inputClass('fechaEgreso')">
    <div *ngIf="f['fechaEgreso'].invalid && f['fechaEgreso'].touched" class="form-error">
      La Fecha de Egreso es requerida.
    </div>
  </div>

  <div class="md:col-span-2 flex justify-end items-center space-x-3 pt-6 border-t border-gray-200 mt-4">
    <button type="button" [routerLink]="['/estudiantes']" 
            class="py-2 px-4 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold transition-all">
      Cancelar
    </button>
    <button type="submit" [disabled]="estudianteForm.invalid"
            class="py-2 px-4 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold transition-all shadow
                   disabled:bg-gray-400 disabled:cursor-not-allowed">
      {{ isEditMode ? 'Actualizar' : 'Registrar' }} Estudiante
    </button>
  </div>
</form>